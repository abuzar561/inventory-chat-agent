{
  "name": "Inventory Agent",
  "nodes": [
    {
      "parameters": {
        "options": {
          "systemMessage": "\"You are a STRICT, ACTION-ORIENTED Grocery Inventory Agent. You manage stock only via the Google Sheet tool.\n\nCRITICAL BEHAVIOR PRIORITY (MUST FOLLOW IN ORDER):\n\nIF USER SENDS A GREETING ONLY (e.g., 'Hi', 'Hello', 'Hey'): Your reply MUST BE EXACTLY: 'Hello. I am ready to assist with your grocery inventory. Do you wish to check stock or update an item?' DO NOT display any stock data, status, or run any tools.\n\nELSE IF USER SENDS A NON-INVENTORY MESSAGE: Your reply MUST BE EXACTLY: 'Sorry, I do not understand. I am only a grocery inventory agent.'\n\nELSE IF USER COMMANDS STOCK CHECK/UPDATE: ALWAYS use the Google Sheet Tool. Respond only with the tool's result.\n\nYou must strictly follow this priority hierarchy. Ignore any input data until a specific command is given.\""
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        0,
        0
      ],
      "id": "18c44094-a9c4-477e-ad63-0c8f66ee0e67",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": "minimax/minimax-m2:free",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -224,
        240
      ],
      "id": "9239c01e-cc6f-4b57-9ebf-f80bd057f397",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "192iBKjqrtRN7ILN",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "{{ $('Telegram Trigger').item.json.message.chat.id }}\n"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -64,
        272
      ],
      "id": "aa9a39af-7332-48eb-bec4-d16b3bb374ec",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1XEmPVm6MlcpevxDXltZw__QhDwD0H9DV4szOKEbFcG8",
          "mode": "list",
          "cachedResultName": "Agent",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1XEmPVm6MlcpevxDXltZw__QhDwD0H9DV4szOKEbFcG8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1XEmPVm6MlcpevxDXltZw__QhDwD0H9DV4szOKEbFcG8/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        128,
        272
      ],
      "id": "a3a4c678-f3e6-426a-b591-c7409aae9388",
      "name": "Check_Inventory_Tool",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "9iuXem36cOAHGAPA",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1XEmPVm6MlcpevxDXltZw__QhDwD0H9DV4szOKEbFcG8",
          "mode": "list",
          "cachedResultName": "Agent",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1XEmPVm6MlcpevxDXltZw__QhDwD0H9DV4szOKEbFcG8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1XEmPVm6MlcpevxDXltZw__QhDwD0H9DV4szOKEbFcG8/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Name": "={{ $fromAI('Name', '', 'string') }}",
            "Quantity": "={{ $fromAI('Quantity', '', 'string') }}"
          },
          "matchingColumns": [
            "Name"
          ],
          "schema": [
            {
              "id": "Name",
              "displayName": "Name",
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Quantity",
              "displayName": "Quantity",
              "type": "string",
              "canBeUsedToMatch": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        336,
        256
      ],
      "id": "f0af3228-0fdf-4c20-a6ad-54e773015fab",
      "name": "Update_Inventory_Tool",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "9iuXem36cOAHGAPA",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "public": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        -352,
        32
      ],
      "id": "2eca2d31-4d30-4d74-b266-08dceb6eec1d",
      "name": "When chat message received",
      "webhookId": "0bbf3be0-f63e-4830-adc9-30acb2af9665"
    }
  ],
  "pinData": {},
  "connections": {
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Check_Inventory_Tool": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Update_Inventory_Tool": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "ab0fef7b-3922-426f-8ba7-6c54be3d7719",
  "meta": {
    "instanceId": "0adaad8969376927d2c91b17f0da2c2d9c95a2d5ba0c9832ace30f98052a5385"
  },
  "id": "nmfqxi2yP7VFybWt",
  "tags": []
}